---
title: 6. PSI Helpers and Utilities
---

Helper classes and utilities can be embedded in the code generated by Grammar-Kit.

* bullet item
{:toc} 

## 6.1. Define Helper Methods for Generated PSI Elements
Custom methods in PSI classes are defined separately, and Grammar-Kit embeds them into generated code.
Define a utility class with these helper methods:
```java
package com.intellij.sdk.language.psi.impl;

import com.intellij.lang.ASTNode;
import com.intellij.sdk.language.psi.*;

public class SimplePsiImplUtil {
  public static String getKey(SimpleProperty element) {
    ASTNode keyNode = element.getNode().findChildByType(SimpleTypes.KEY);
    if (keyNode != null) {
      // IMPORTANT: Convert embedded escaped spaces to simple spaces
      return keyNode.getText().replaceAll("\\\\ ", " ");
    } else {
      return null;
    }
  }
  
  public static String getValue(SimpleProperty element) {
    ASTNode valueNode = element.getNode().findChildByType(SimpleTypes.VALUE);
    if (valueNode != null) {
      return valueNode.getText();
    } else {
      return null;
    }
  }
}
```

The parser generates the `SimpleProperty` interface referenced in the code above. 

## 6.2. Update Grammar and Regenerate the Parser
Now the utility class is added to the grammar file via the `psiImplUtilClass` attribute.
Add methods for a particular rule to specify which one should be used for PSI classes.
Compare the last line of the grammar below to the [previous definition](/tutorials/custom_language_support/grammar_and_parser.md#33-define-the-grammar).

```java
{
  parserClass="com.simpleplugin.parser.SimpleParser"

  extends="com.intellij.extapi.psi.ASTWrapperPsiElement"

  psiClassPrefix="Simple"
  psiImplClassSuffix="Impl"
  psiPackage="com.simpleplugin.psi"
  psiImplPackage="com.simpleplugin.psi.impl"

  elementTypeHolderClass="com.simpleplugin.psi.SimpleTypes"
  elementTypeClass="com.simpleplugin.psi.SimpleElementType"
  tokenTypeClass="com.simpleplugin.psi.SimpleTokenType"

  psiImplUtilClass="com.simpleplugin.psi.impl.SimplePsiImplUtil"
}

simpleFile ::= item_*

private item_ ::= (property|COMMENT|CRLF)

property ::= (KEY? SEPARATOR VALUE?) | KEY {methods=[getKey getValue]}
```

After making changes to the grammar, regenerate the parser and PSI classes.

## 6.3. Define a Utility to Search Properties
Create a utility class to search PSI elements for defined properties over the project.
This utility will be used later when implementing [code completion](https://www.jetbrains.com/help/idea/auto-completing-code.html).
```java
{% include /code_samples/simple_language/src/main/java/com/intellij/sdk/language/SimpleUtil.java %}
```

